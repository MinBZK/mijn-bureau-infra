bases:
  - "../../bases/default.yaml.gotmpl"

releases:
  - name: "keycloak-keycloak"
    chart: charts/keycloak
    version: "24.6.7"
    {{- if .Values.application.keycloak.namespace }}
    namespace: {{ .Values.application.keycloak.namespace }}
    {{- end }}
    installed: {{ .Values.application.keycloak.enabled }}
    {{- if and (eq .Environment.Name "demo") ( .Values.application.keycloak.enabled) }}
    needs:
      - {{ if .Values.application.keycloak.namespace }}{{ .Values.application.keycloak.namespace }}/{{ end }}keycloak-postgresql
    {{- end }}
    values:
      - keycloak.yaml.gotmpl

  - name: "keycloak-postgresql"
    chart: ../common/charts/postgresql
    version: " 16.7.18"
    {{- if .Values.application.keycloak.namespace }}
    namespace: {{ .Values.application.keycloak.namespace }}
    {{- end }}
    installed: {{ and (eq .Environment.Name "demo") ( .Values.application.keycloak.enabled) | toYaml }}
    values:
      - "postgresql.yaml.gotmpl"
